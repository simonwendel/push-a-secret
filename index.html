<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <script src="/app.js"></script>
</head>

<body>
  <script>

    const crypto = window.crypto.subtle;
    const defaultKeySettings = { name: "AES-GCM", length: 128 };

    const app = Elm.Main.init();

    const generateKey = async () => {
      let key = await crypto.generateKey(defaultKeySettings, true, ["encrypt", "decrypt"]);
      let exported = await crypto.exportKey('jwk', key);

      app.ports.receiveKey.send({
        algorithm: exported.alg,
        key: exported.k
      });
    }

    app.ports.requestKey.subscribe(generateKey);

  </script>
</body>

</html>